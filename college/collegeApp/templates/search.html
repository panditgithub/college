{% extends 'base.html' %}
{% block content %}
{% load static %}

<div class="container" style="margin-top: 100px; max-width: 800px;">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h3 class="mb-0"><i class="fas fa-search me-2"></i>Registration Detail</h3>
    </div>
    
    <div class="card-body">
      <form method="GET" action="{% url 'search_user' %}">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="form-floating">
              <input type="text" name="course" id="course" class="form-control" 
                     placeholder="Enter Course" value="{{ request.GET.course }}">
              <label for="course"><i class="fas fa-graduation-cap me-2"></i>Course</label>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="form-floating">
              <input type="text" name="registration" id="registration" class="form-control" 
                     placeholder="Enter Registration Number" value="{{ request.GET.registration }}">
              <label for="registration"><i class="fas fa-id-card me-2"></i>Enter Registration No.</label>
            </div>
          </div>
        </div>
        
        <div class="d-grid mt-4">
          <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-search me-2"></i>Search
          </button>
        </div>
      </form>
    </div>
  </div>

  {% if course or registration %}
  <div class="card shadow-sm mt-4">
    <div class="card-header bg-light">
      <h5 class="mb-0"><i class="fas fa-users me-2"></i>Student Registration No.</h5>
    </div>
    
    <div class="card-body">
      {% if users %}
        <div class="row g-4">
          {% for user in users %}
          <div class="col-md-6">
            <div class="card h-100 border-primary">
              <div class="card-body">
                <div class="d-flex align-items-start">
                  {% if user.profile_picture %}
                  <div class="flex-shrink-0 me-3" style="width: 80px; height: 80px; overflow: hidden;">
                    <img src="{{ user.profile_picture.url }}" 
                         class="rounded-circle border border-primary object-fit-cover" 
                         width="80" height="80" alt="Profile Picture"
                         style="width: 100%; height: 100%; object-fit: cover;">
                  </div>
                  {% else %}
                  <div class="flex-shrink-0 me-3">
                    <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" 
                         style="width: 80px; height: 80px; border: 2px solid #0d6efd;">
                      <i class="fas fa-user text-primary" style="font-size: 2rem;"></i>
                    </div>
                  </div>
                  {% endif %}
                  <div class="flex-grow-1" style="min-width: 0;">
                  <h5 class="card-title text-primary text-truncate">{{ user.first_name }} {{ user.last_name }}</h5>
                  <div class="user-details">
                    <p class="mb-1 text-truncate"><i class="fas fa-graduation-cap me-2"></i><strong>Course:</strong> {{ user.course }}</p>
                    <p class="mb-1 text-truncate"><i class="fas fa-id-card me-2"></i><strong>Registration:</strong> {{ user.registration }}</p>
                    <p class="mb-1"><i class="fas fa-envelope me-2"></i><strong>Valid Up:</strong> {{ user.valid }}</p> <!-- Removed text-truncate -->
                    <p class="mb-0 text-truncate"><i class="fas fa-phone me-2"></i><strong>Phone:</strong> {{ user.phone }}</p>
                  </div>
                </div>
                  </div>
              </div>
              <div class="card-footer bg-transparent">
                <a href="#" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye me-1"></i> View Profile
                </a>
                <a href="#" class="btn btn-sm btn-outline-success ms-2">
                  <i class="fas fa-envelope me-1"></i> Contact
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-warning d-flex align-items-center" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <div>
            No users found matching your search criteria. Please try different parameters.
          </div>
        </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>

<style>
  .user-details p {
    margin-bottom: 0.3rem;
    font-size: 0.9rem;
  }
  
  .card-title {
    margin-bottom: 0.8rem;
  }
  
  .card.h-100 {
    transition: transform 0.2s;
  }
  
  .card.h-100:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(13, 110, 253, 0.1);
  }
  
  /* Ensure images don't overflow their containers */
  .object-fit-cover {
    object-fit: cover;
  }
  
  /* Prevent text overflow for specific elements only */
  .text-truncate {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  /* Responsive adjustments */
  @media (max-width: 576px) {
    .user-details p {
      white-space: normal;
      word-break: break-word;
    }
    
    .flex-shrink-0.me-3 {
      width: 60px !important;
      height: 60px !important;
    }
  }
</style>

{% endblock %}
